<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Basketball Rules Quiz – Quick Challenge</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#071228; --card:#082033; --accent:#f59e0b; --text:#e9f2ff; --muted:#9fb4cf;
    --correct-bg: rgba(34, 197, 94, 0.2);
    --correct-border: #22c55e;
    --incorrect-bg: rgba(239, 68, 68, 0.15);
    --incorrect-border: #ef4444;
  }
  *{box-sizing:border-box; scroll-behavior: smooth;}
  body{margin:0; font-family:Inter,system-ui,Segoe UI,Roboto; background:linear-gradient(180deg,#031020,#071228); color:var(--text); display:flex; align-items:center; justify-content:center; padding:18px; min-height:100vh}
  .wrap{width:100%;max-width:820px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.6)}
  header{display:flex;align-items:center;gap:12px}
  .ball{width:56px;height:56px;border-radius:50%;background:conic-gradient(from 200deg,#f59e0b,#ef4444);display:flex;align-items:center;justify-content:center;font-weight:700;color:#082033}
  h1{margin:0;font-size:20px}
  p.lead{margin:6px 0 14px;color:var(--muted)}
  form{margin-top:6px}
  .q{background:rgba(255,255,255,0.02); padding:12px;border-radius:10px;margin-bottom:10px}
  .q p{margin:0 0 8px 0}
  label.option{display:block;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);margin-bottom:7px;cursor:pointer; transition: background 0.2s, border-color 0.2s;}
  input[type=radio]{margin-inline-end:8px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  input[name=name]{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:var(--text);min-width:180px}
  button.btn{background:var(--accent);border:0;padding:10px 14px;border-radius:10px;font-weight:700;color:#07203a;cursor:pointer}
  .small{font-size:13px;color:var(--muted)}
  .resultBox{margin-top:12px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)}
  .leader{margin-top:14px}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{padding:8px;text-align:left;font-size:14px}
  th{color:var(--muted);font-weight:600}
  tr:nth-child(even){background:rgba(255,255,255,0.01)}
  footer{margin-top:14px;font-size:13px;color:var(--muted)}
  .fun{font-weight:700;color:#22c55e}
  
  /* --- ADDED STYLES for correct/incorrect --- */
  label.option.correct {
    background: var(--correct-bg);
    border-color: var(--correct-border);
    font-weight: 600;
  }
  label.option.selected-incorrect {
    background: var(--incorrect-bg);
    border-color: var(--incorrect-border);
    text-decoration: line-through;
    opacity: 0.7;
  }
  /* Style to disable form after submission (for the review form) */
  form.submitted {
    pointer-events: none;
    opacity: 0.9;
  }
  /* --- END ADDED STYLES --- */

  @media (max-width:560px){.row{flex-direction:column;align-items:stretch} input[name=name]{width:100%}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <header>
        <div class="ball">B</div>
        <div>
          <h1>Basketball Rules Quiz — Quick Challenge</h1>
          <p class="lead">8 tricky questions about common rules. Honest, short, and fun — show who knows how to think like a ref!</p>
        </div>
      </header>

      <div id="quizSection">
        <form id="quizForm">
                    <div class="q">
            <p><strong>1.</strong> A player dribbles, then stops holding the ball, and later starts dribbling again. What is the violation?</p>
            <label class="option"><input type="radio" name="q1" value="double"> Double dribble</label>
            <label class="option"><input type="radio" name="q1" value="travel"> Travel</label>
            <label class="option"><input type="radio" name="q1" value="legal"> No violation</label>
          </div>

                    <div class="q">
            <p><strong>2.</strong> A player jumps to shoot, changes mind while in the air and lands without releasing the ball. What is the call?</p>
            <label class="option"><input type="radio" name="q2" value="no_call"> No violation</label>
            <label class="option"><input type="radio" name="q2" value="travel"> Travel</label>
            <label class="option"><input type="radio" name="q2" value="offensive"> Offensive foul</label>
          </div>

                    <div class="q">
            <p><strong>3.</strong> A player steps on the sideline while holding the ball. What happens?</p>
            <label class="option"><input type="radio" name="q3" value="out"> Ball out of bounds — turnover</label>
            <label class="option"><input type="radio" name="q3" value="play_on"> Play continues</label>
            <label class="option"><input type="radio" name="q3" value="tech"> Technical foul</label>
          </div>

                    <div class="q">
            <p><strong>4.</strong> A player shoots, and another player lightly touches the shooter's hand after the ball has already left the shooter's fingers. Is this a foul?</p>
            <label class="option"><input type="radio" name="q4" value="foul"> Yes — offensive/defensive foul</label>
            <label class="option"><input type="radio" name="q4" value="no_foul"> No — not a foul if contact after release</label>
            <label class="option"><input type="radio" name="q4" value="depends"> Depends on how hard the contact was</label>
          </div>

                    <div class="q">
            <p><strong>5.</strong> The ball goes into the hoop from underneath (it enters the basket from below). What's the ruling?</p>
            <label class="option"><input type="radio" name="q5" value="count"> Counts as a score</label>
            <label class="option"><input type="radio" name="q5" value="no_score"> No score — illegal</label>
            <label class="option"><input type="radio" name="q5" value="foul"> Foul on shooter</label>
          </div>

                    <div class="q">
            <p><strong>6.</strong> Is it legal to dribble with both hands on the ball simultaneously (i.e., push the ball with both palms at once)?</p>
            <label class="option"><input type="radio" name="q6" value="allowed"> Yes — allowed</label>
            <label class="option"><input type="radio" name="q6" value="not_allowed"> No — not allowed</label>
          </div>

                    <div class="q">
            <p><strong>7.</strong> A player receives a pass while both feet are off the ground (in the air) and lands on the floor afterward. Is this legal?</p>
            <label class="option"><input type="radio" name="q7" value="legal"> Legal</label>
            <label class="option"><input type="radio" name="q7" value="illegal"> Illegal — travel</label>
            <label class="option"><input type="radio" name="q7" value="depends"> Depends on how many steps he takes after landing</label>
          </div>

                    <div class="q">
            <p><strong>8.</strong> A player intentionally throws the ball forcefully at an opponent (aiming at them). The opponent catches the ball and immediately scores. Does the basket count or is there a foul/penalty?</p>
            <label class="option"><input type="radio" name="q8" value="count"> The basket counts</label>
            <label class="option"><input type="radio" name="q8" value="no_count"> Basket does not count — unsportsmanlike / technical on the thrower</label>
            <label class="option"><input type="radio" name="q8" value="referee"> Referee discretion — possible flagrant/technical</label>
          </div>
        </form>
      
                <div class="small" style="margin-top:14px;">Enter your name (displayed on leaderboard):</div>
        <div class="row" style="margin:8px 0 14px;">
          <input name="name" id="playerName" placeholder="Your name (e.g. Kapibara)" />
          <div style="flex:1"></div>
          <button class="btn" id="submitBtn">Submit & Save</button>
        </div>
      </div>
      <div id="resultsSection" style="display:none;">

        <div class="leader">
          <div class="small">Public leaderboard (top scores):</div>
          <table id="leaderboard" aria-live="polite"><thead><tr><th>Name</th><th>Score</th><th>Correct / Total</th><th>Time</th></tr></thead><tbody></tbody></table>
        </div>

        <div id="result" class="resultBox" style="display:none; margin-top: 20px;"></div>

        <div id="reviewSection" style="margin-top: 20px;">
          </div>

      </div>
            <footer>
        <div class="small">Notes: This quiz saves results to a public leaderboard. Please use first name / nickname only.</div>
      </footer>
    </div>
  </div>

    <script type="module">
    // ---------- CONFIGURE: replace with your Firebase config ----------
  const firebaseConfig = {
  apiKey: "AIzaSyBHPwobpJPs5OKVK8GapzAJnIgkKIeoN6M",
  authDomain: "basketball-quiz-1dd78.firebaseapp.com",
  databaseURL: "https://basketball-quiz-1dd78-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "basketball-quiz-1dd78",
  storageBucket: "basketball-quiz-1dd78.firebasestorage.app",
  messagingSenderId: "181665936126",
  appId: "1:181665936126:web:e3bdbb773ec9bc30ca6baf",
  measurementId: "G-R3SM5RRH7B"
};
    // -----------------------------------------------------------------

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const responsesRef = ref(db, 'basketball_quiz_responses');

    const correctAnswers = {
      q1: 'double', q2: 'travel', q3: 'out', q4: 'no_foul',
      q5: 'no_score', q6: 'not_allowed', q7: 'legal', q8: 'no_count'
    };

    // helpers
    function readForm(){
      const form = document.getElementById('quizForm');
      const data = {};
      for(let i=1;i<=8;i++){
        const el = form.querySelector(`[name=q${i}]:checked`);
        data['q'+i] = el ? el.value : null;
      }
      return data;
    }

    function computeScore(answers){
      let correct=0, total=8;
      for(let i=1;i<=8;i++){
        const k = 'q'+i;
        if(answers[k] && answers[k] === correctAnswers[k]) correct++;
      }
      return {correct, total, percent: Math.round(100*correct/total)};
    }

    // submit handler
    document.getElementById('submitBtn').addEventListener('click', async ()=>{
      const nameInput = document.getElementById('playerName');
      const name = (nameInput.value || 'Anonymous').trim().slice(0,40);
      if(!name){ alert('Please enter your name (or nickname).'); return; }

      const answers = readForm();
      if(Object.values(answers).every(v=>v===null)){ alert('Please answer at least one question.'); return; }

      const score = computeScore(answers);
      const payload = { name, answers, score, ts: new Date().toISOString() };

      // push to firebase
      try{
        const newRef = push(responsesRef);
        await set(newRef, payload);
        
          // --- NEW FLOW ---
          // 1. Populate the hidden results section
          showResult(payload);

          // 2. Hide quiz, show results
          document.getElementById('quizSection').style.display = 'none';
          document.getElementById('resultsSection').style.display = 'block';

          // 3. Scroll to leaderboard
          document.getElementById('leaderboard').scrollIntoView({ behavior: 'smooth', block: 'start' });

      }catch(err){
        console.error('Failed to save:',err);
        alert('Saving failed. Check your Firebase config and rules.');
      }
    });

    // show result and fun feedback
    function showResult(payload){
      const r = payload.score;
      const el = document.getElementById('result');
      const jokes = [
        "Nice! You either studied referees or you're a natural-born rules detective.",
        "Well played — you're almost ready to wear a whistle.",
        "Impressive — maybe you'll be the class ref next game!",
        "Solid score — you passed Ref 101 with brownie points."
      ];
      const fun = jokes[Math.floor(Math.random()*jokes.length)];
      
      // 1. Show score box
      el.style.display = 'block';
      // (Removed the explanation list from here)
      el.innerHTML = `<div style="font-weight:700">${payload.name}, your score: ${r.correct}/${r.total} (${r.percent}%)</div>
                      <div class="small fun" style="margin-top:6px">${fun}</div>`;

      // 2. Clone form, highlight answers, and add to review section
      const quizForm = document.getElementById('quizForm');
      const reviewSection = document.getElementById('reviewSection');
      reviewSection.innerHTML = '<h3 style="color: var(--accent);">Your Answers Review:</h3>'; // Title for review
      
      const reviewForm = quizForm.cloneNode(true); // Deep clone
      reviewForm.id = 'reviewForm'; // New ID
      reviewForm.classList.add('submitted'); // Add class to style it

      // Disable all inputs in the cloned form
      reviewForm.querySelectorAll('input[type=radio]').forEach(input => {
        input.disabled = true;
      });

      // Highlight answers on the *cloned* form
      for(let i=1; i<=8; i++){
        const key = 'q'+i;
        const userAns = payload.answers[key];
        const correctAns = correctAnswers[key];
        
        try {
          // Find correct label *within reviewForm*
          const correctLabel = reviewForm.querySelector(`label.option > input[name=${key}][value="${correctAns}"]`).parentElement;
          if (correctLabel) correctLabel.classList.add('correct');
        } catch(e) { console.warn(`Could not find correct label for ${key}`); }

        if (userAns && userAns !== correctAns) {
          try {
            // Find user's wrong label *within reviewForm*
            const wrongLabel = reviewForm.querySelector(`label.option > input[name=${key}][value="${userAns}"]`).parentElement;
            if (wrongLabel) wrongLabel.classList.add('selected-incorrect');
          } catch(e) { console.warn(`Could not find user label for ${key}`); }
        }
      }

      // Add the completed review form to the page
      reviewSection.appendChild(reviewForm);
    }

    // live leaderboard: read all responses and render sorted
    function renderLeaderboard(items){
      items.sort((a,b)=>{
        if(b.score.percent !== a.score.percent) return b.score.percent - a.score.percent;
        if(b.score.correct !== a.score.correct) return b.score.correct - a.score.correct;
        return new Date(a.ts) - new Date(b.ts);
      });

      const tbody = document.querySelector('#leaderboard tbody');
      tbody.innerHTML = '';
      items.slice(0,20).forEach(it=>{
        const tr = document.createElement('tr');
        const time = new Date(it.ts).toLocaleString();
        tr.innerHTML = `<td>${escapeHtml(it.name)}</td><td>${it.score.percent}%</td><td>${it.score.correct}/${it.score.total}</td><td class="small">${time}</td>`;
        tbody.appendChild(tr);
      });
    }

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    // listen for changes in DB and update leaderboard
    onValue(responsesRef, (snap)=>{
      const val = snap.val();
      const list = val ? Object.values(val) : [];
      renderLeaderboard(list);
    }, (err)=>{ console.error('DB read error',err); });

  </script>
</body>
</html>
